Wireless Charging for Electric Vehicles II
 
 
Aidan Lonsky
Michael Hatzikokolakis
Rebecca Suen
Michelle Pham
 
EE198B Senior Project Final Report
Department of Electrical Engineering
San Jose State University
 
December 9, 2018
 
Project advisor: Dr. Mohamed Badawy
 
 
 

 

Executive Summary

The purpose of this project was to design a rectifier subsystem as part of a wireless charging system for Electric Vehicles (EVs). Currently, the logistics of charging EVs can be inconvenient or impractical, which discourages people from adopting EVs. Incorporating a wireless charging system into the infrastructure would allow people to charge EVs simply by driving as they normally do.

A bridgeless boost PFC rectifier was chosen as the rectifier topography for this project. The approach taken was combining a hardware main rectifier circuit with digital feedback control via use of a Texas Instruments microcontroller. The rectifier was designed by first simulating the system as a whole using MATLAB’s Simulink program, then breaking it down into the hardware and feedback control components. Following simulation, hardware was chosen based on values reported in simulation, the circuit was specified in OrCAD and finally exported to Allegro PCB Designer for printed circuit board (PCB) layout. The feedback control was programmed using Texas Instruments Code Composer Studio.

While we were not able to achieve our goal of building the completed physical circuit in the timeframe specified, we made significant progress towards our goal. On the hardware side, we had designed a full circuit, chosen appropriate components, and laid out the circuit in preparation for PCB routing. On the feedback control side, we were able to create an error signal from two AC inputs and use it to change the duty cycle of an output PWM signal.

Table of Contents
 
1.    Introduction
2.    Methodology
3.    Results and discussion   	               	      
4.    Conclusions and recommendations	      
5.    References    	                                       
6.    Appendix

1. Introduction

Today’s society is slowly moving towards green energy in an effort to combat climate change. A major component of that is switching from internal combustion engine (ICE) vehicles to EVs. However, for many people the logistics of charging an EV is still a major deterrent from adopting an EV. Currently, EVs do not have as much range as an ICE vehicle, which causes what is known as “range anxiety.” EVs have a long charging time, especially when compared to the time it takes to fill up a gas tank at a gas station. Additionally, many people do not have a garage at home, which can make charging an EV a bit of a challenge. In order to support the widespread use of EVs, it is salient that public infrastructure have the ability to support charging them. One promising solution to this problem is to utilize high-power wireless power transfer (WPT) [1], [2]. By installing WPT charging points in public parking spots, drivers could reap the benefits of contactless charging whenever they are park. The ultimate goal, however, would be to have WPT chargers embedded in the roads to allow for charging while driving.


Fig. 1.    WPT charging system [1].

This project focused on the input rectifier and power factor correction (PFC) sub-system of the overall WPT charging system shown in Figure 1. The approach taken was combining a hardware main rectifier circuit with digital feedback control via use of a Texas Instruments microcontroller. The rectifier was designed by first simulating the system as a whole using Simulink, then breaking it down into the hardware and feedback control components. Obtaining proper simulations proved that the theory was correct, providing the confidence needed to actualize the design. From here, the task was split between the power circuits design and the control software design.

The impact of this project is that it would be one step closer to achieving WPT charging for EVs. With full integration of WPT charging in the infrastructure for both stationary and dynamic use, EVs will become more accessible. EV ownership would become feasible for people who do not have the luxury of having a private garage to charge an EV. Complete replacement of ICE vehicles with EVs would result in better air quality for everyone. In addition, developing countries and developed countries alike would see decreased dependency on oil, be it domestic or imported, which reduces the currently egregious need for this finite source of energy.
 
2. Methodology
2.1. Design Objective and Goal
The goal of this project was to design a single-phase bridgeless boost PFC rectifier with digital feedback control from a microcontroller. This rectifier converts an AC signal from a standard 120V outlet into a 200V DC signal to be used for the next WPT stages. This converter was also specified to achieve unity power factor while minimizing the total harmonic distortion induced.

2.2. Theory
In order to provide wireless power transfer, precise control must be maintained over the frequency and voltage of the AC signal to the transmitting coils. To achieve this, the AC power must be rectified to DC since directly altering the frequency of an AC signal is generally considered to be unfeasible. In addition, the power drawn from the converter is varying and reactive which leads to the consumption of reactive power. This reactive power is undesirable for the fact that it causes strain on the utility. To alleviate this symptom, a switching mechanism needs to be employed to modulate the current drawn from the converter. This in effect prevents phase shift (and thus reactive power draw) between the input voltage and current waveform and hence maintains a unity power factor. To further complicate things, attention must be paid to the noise created by the nonlinear switching devices. Thus, the ideal rectifier is one that consumes only real power while not contributing any harmonics to the grid.


A bridgeless boost PFC rectifier was the chosen topography because of its reduced number of semiconductors. Generally, a reduction in the number of semiconducting device reduces the amount of switching losses, as well as the cost. One negative consequence of this reduction, however, is an increase in noise introduced [3]. This was taken into consideration when dealing with THD among other things. The bridgeless boost PFC rectifier also features a relatively straight-forward control scheme. The four states of its operation can be cycled through with relative ease by the microcontroller.

The decision to use digital feedback control was made for its ease of implementation and separate development. The alternative analog control gives less margin for error in the beginning design of this converter.

2.3. Overall System
The overall system for our rectifier design can be seen as two major components: the bridgeless boost rectifier circuit and the microcontroller unit (MCU). The feedback control system receives inputs from the rectifier circuit and outputs a PWM signal to control the switches of the converter. This feedback system features two feedback loops that control for the current input and the voltage output by the PFC rectifier. For prototyping, the input EMI filter and soft start circuitry, as well as the lower bus voltage supply, was outsourced to external test circuitry.


Fig. 2.   Block diagram of rectifier system.

Using Simulink software, the overall system comprising both the rectifier and feedback control was simulated to serve as a starting point for designing the circuit.


Fig. 3.    Simulink model of bridgeless boost PFC rectifier.

The dual loops can be identified in the figure above by tracing the output voltage sensor and the input current sensor paths. This dual control scheme is achieved by multiplexing the voltage error with the current error for processing [4]. Each loop also features a PI controller for stability performance. Thus, the PF and the output voltage can be controlled.

The simulation output below shows how the current draw matches the reference signal in steady state, demonstrating that the feedback control is working correctly. The current draw shows an initial spike when the system first turns on is due to the in-rush current imposed by the discharged capacitor and inductor. This current spike is to be mitigated by implementing a soft start component. The system in this project will implement the soft start externally. Additionally, the voltage transient is shown. This shows the slower voltage response as compared with the current response [4]. Tuning the compensators of each loop requires precision to maintain stability. 

The power factor is a value between 0-1 and should be as close to 1 as possible. If the feedback control is working, the error signal should approach 0, which it appears to be very close to in the simulation results. 


Fig. 4.    Simulink current model results: a) current draw, b) error signal, c) reference signal, d) power factor.

Fig. 5.    Simulink voltage model results: a) output voltage, b) input current, c) reference signal.

2.4. Circuit Design
2.4.1. Schematics
After performing Simulink simulations to ensure that the overall system was acceptable, the circuit was designed using OrCAD. Components were selected based on highest expected outputs from simulations. 

This circuit was designed to require both an AC input for the rectifier as well as a 15V DC input from a power supply for the system components. Capacitor decoupling was used after each input to help ensure a clean signal. A fuse was placed after the AC input to provide overall circuit protection. 15V was selected for the DC input because that is the highest DC input required by any component in this system. The 15V DC power would be additionally stepped down to 5V using Recom Power RY-1505S isolated DC/DC regulated converters for both the voltage and current sensors. 

Isolation is necessary to separate the grounds of the power circuit from the control circuitry to reduce the transmitted noise and current surges. Additional protection is provided to prevent damage of the microcontroller. For this reason, the Texas Instruments UCC5350MCD isolated gate driver and a voltage regulator designed with a Linear Technology LT1797CS5 buffered opamp were chosen as components in this circuit. Furthermore, all sensor outputs to the microcontroller include zener diodes.






Fig. 6.    ORCAD Capture schematic page 1.

Fig. 7.    ORCAD Capture schematic page 2.

Fig. 8.    ORCAD Capture schematic page 3.

In the first page of schematics above (Figure 5), the terminal blocks that connect the input and output power can be identified as JP4, JP5, JP6. To the right, the two isolated voltage regulators U4 and U5 provide the necessary rails to the TTL logic of the sensors on the board. The headers JP1, JP2, and JP3 (seen in Figure 6) are the point of interface with the MCU.

The second page of schematics features the current sensor U3 at the top along with the decoupling capacitors. Below that the rectifier itself can be identified by its diode and MOSFET legs. Further down one of the gate drivers U2 is visible with the associated decoupling capacitor chain for power supply smoothing. There includes a separate but identical gate driver circuit in the final design that is not duplicated in the figure as well.

The third page shows the two voltage sensor circuits U6 and U7. These are simple voltage dividers with buffer opamps connected. Again, these opamps provide isolation, as well as combat the loading conditions present when using resistor dividers.

2.4.1. PCB Layout
With completion of the full circuit design, the next step was to layout the PCB. Most of the components had standard PCB footprints that were readily available to use, but several components required design of the PCB footprint using Allegro Package Designer. The designed PCB footprints are shown below.


Fig. 9.    PCB footprints for: (from left to right) LEM USA Inc. HLSR 10-P current sensor, 
Triad Magnetics C-59U inductor, and Cornell Dubilier Electronics 380LX152M200A042 capacitor. 

Once all components were associated with a footprint, the circuit could be properly netlisted and exported to Allegro PCB Editor for layout. The layout was completed by keeping the power components and sensor components separated from each other. The voltage input and output terminal blocks and the microcontroller interface headers were placed at the edges for ease of access. Routing was to be completed using a two layer board and large copper pours to provide the separate grounds. 


Fig .10.    PCB Layout.

2.5. Feedback Control
2.5.1. Controller
The controller used for this application was a Texas Instruments TMS320F28335. This microcontroller was chosen for its minimalistic design and easy access to peripheral pins through the compatible C2000 docking station. 

2.5.2. Analog to Digital Conversion
To operate a digital control feedback subsystem within a larger analog system, any and all inputs would need to be moved from the analog to digital domain. The onboard ADC peripheral of the F28335 would be used in this operation. To be able to use the ADC peripheral, multiple parameters were set to control the specific way the ADC functioned. The code pertaining to this setup is shown in Figure 11 below. 


Fig .11.   ADC setup code

The ADC was used in freerun mode for continuous capture of inputs. It was also operated in cascaded mode, allowing for more diverse control over multiple ADC channels, yet this option proved unnecessary in the final stages. It should be noted that the IDE used, Code Composer Studio (CCS), allowed for easy graphing of recorded signals, which was used to determine that only a very low level of noise was introduced by the ADC into the signal.

The final model of the controls system utilizes three separate ADC channels to read three inputs. These inputs are a measured voltage signal, current signal, and a reference signal generated by a Phase Locked Loop (PLL). By having these signals converted to the digital domain, the mathematical difference between the signal can be calculated and stored for use in the PI controller feedback portion of the system.

2.5.3. PWM Generation
The goal of the feedback system is to be able to properly control the MOSFETs in the rectifier. This is achieved by sending a varying PWM signal to the gates of the FETs. As part of a PFC system, the varying duty cycle of the PWM compensates for the non-idealities of the reactive power induced by passive components.

To begin generating a PWM signal that would be appropriate for control, the duty cycle of an arbitrary PWM signal was manipulated. This knowledge was used in being able to control the duty cycle of the PWM based on analog input. The PWM signal was generated by using an asymmetrical upcount method. The asymmetric portion indicates that the on time of the period is generated at the start of the signal, rather than at the middle of the signal. While asymmetrical PWM signals may be easier to generate, their application is limited primarily to systems that care more about the average voltage output, and not specifically the timing of when the PWM switches to a high state. The upcount method can be viewed below in Figure 12.



Fig. 12.	Upcount, Single Edge Asymmetric Waveform With Independent Modulation of EPWMxA and EPWMxB, [5].


The code used to generate the initial PWM signal can be viewed below in Figure 13.





Fig .13.   PWM setup code

With control over both the ADC and PWM peripherals, a basic implementation of the feedback system was created. The code for this system can be found in Figure 14 below.


Fig .14. Feedback control loop code.

A simplified version of this system was tested by generating a sine PWM waveform with output verification. Further completion of this system using a PLL and PI controller is detailed later.

3. Results and discussion
As conveyed in the discussion section, the project was mapped out, simulated, and designed. In designing the circuits, parts were specified for their tolerances and values, and their corresponding footprints collected or created. In addition, the bill of materials was collated and the parts were ordered. While circuit design was underway, the software was being developed. Using the docking station, the peripherals needed for control were tested and functions written. Specifically, the ADC and timers were initialized to read values and output PWM signals.

Also provided in the discussion in Figure 4 is a glimpse of the converter’s simulated performance. The values obtained from simulation include the desired values of the passives in the circuit, as well as the PI parameters for tuning. The resulting waveforms were true to theory which gave the confidence necessary to go forward with the design.

In the end the project fell short of the timeline specified in the proposal. Having had more time, the PCB would have been printed and undergone testing. This would have brought the two systems together for the first time. Faults would have been analysed and data collected to learn how feasible the design was and give insight into possible iterations for the future.
 
4. Conclusions and recommendations
As mentioned before, the next step would be completion of this rectifier system. On the hardware side, the PCB would need to be routed and fabricated, then all components would need to be soldered on. On the feedback control side, a PLL will be implemented. The PLL is a system of multiple components that constantly adjusts a voltage to match the phase of an input signal. The output of the PLL is a reference signal that will be used to produce an error signal that is fed into the PI controller. The PI controller is then the next function to be completed. It is necessary to produce an output signal with low steady state error and an overall stable output. This is important because the PI controller is what filters the error which leads to the varying duty cycle generated by the PWM.

After completion of this single-phase rectifier, the design could then be implemented into a three-phase design. A three-phase design is necessary to utilize the three-phase power delivered by utility companies. Additionally, a three-phase converter is ideal so that three coils can be used per inverter module.


Fig. 15.    Three-phase rectifier system, [6].

The impact of this system on society would be the ability to fully replace ICE vehicles with EVs and greatly reduce the amount of emissions from use of ICE vehicles. EVs would no longer be practical only for a select number of wealthier individuals but would become accessible to all. Full elimination of ICE vehicles in favor of EVs would result in better air quality for everyone. The goal is that countries around the globe would significantly reduce or eliminate their consumption of oil as a result.
 
5. References

[1]	A. Daga, J. M. Miller, B. R. Long, R. Kacergis, P. Schrafel, and J. Wolgemuth, "Electric Fuel Pumps for Wireless Power Transfer: Enabling rapid growth in the electric vehicle market," IEEE Power Electron. Mag., vol. 4, no. 2, pp. 24-35, June 2017. doi: 10.1109/MPEL.2017.2692379.
[2]  	R. Bosshard and J. W. Kolar, "Inductive power transfer for electric vehicle charging: Technical challenges and tradeoffs," IEEE Power Electron. Mag., vol. 3, no. 3, pp. 22-30, Sept. 2016. doi: 10.1109/MPEL.2016.2583839.
[3] 	L. Huber, Y. Jang, and M. M. Jovanovic, "Performance Evaluation of Bridgeless PFC Boost Rectifiers," IEEE Transactions on Power Electronics, vol. 23, no. 3, pp. 1381-1390, May 2008. doi: 10.1109/TPEL.2008.921107
[4]	G. E. Mejía-Ruiz, N. Muñoz-Galeano, and J. M. Lopez-Lezama, "Modeling and development of a bridgeless PFC Boost rectifier," Revista Facultad de Ingeniería, no. 82, pp. 9-21, Dec. 2018. doi: 10.17533/udea.redin.n82a02
[5]	Texas Instruments, “Enhanced Pulse Width Modulator (ePWM) Module,” TMS320x2833x, 2823x datasheet, pp.45, Oct. 2008 [Revised Jul. 2009]
[6]	R. Greul, S. D. Round, and J. W. Kolar, "Analysis and Control of a Three-Phase, Unity Power Factor Y-Rectifier," IEEE Transactions on Power Electronics, vol. 22, no. 5, pp. 1900-1911, Sept. 2007. doi: 10.1109/TPEL.2007.904187



6. Appendix

Software:
MATLAB Simulink
Cadence OrCAD 16.6
Cadence Pad Designer
Cadence Package Designer
Cadence Allegro PCB Editor
Texas Instruments Code Composer Studio

Hardware:
Texas Instruments TMS320F28335 microcontroller
Components listed on bill of materials (BOM)


Bill of Materials:


